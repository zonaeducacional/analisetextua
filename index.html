<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferramenta de An√°lise Textual Completa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .tab-button.active {
            border-color: #3b82f6;
            color: #3b82f6;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">An√°lise Textual Avan√ßada</h1>
            <p class="text-lg text-gray-600 mt-2">Sua ferramenta completa para an√°lise e aprimoramento de textos, agora com foco no ENEM.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Coluna de Entrada de Texto -->
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-4">Seu Texto</h2>
                <textarea id="text-input" class="w-full h-96 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 resize-y" placeholder="Cole ou digite sua reda√ß√£o aqui..."></textarea>
                <div class="mt-4 flex flex-wrap gap-3">
                    <button id="analyze-btn" class="flex-grow bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">Analisar Texto</button>
                    <button id="clear-btn" class="flex-grow bg-red-500 text-white font-semibold py-3 px-6 rounded-lg hover:bg-red-600 transition duration-300 shadow-md">Limpar</button>
                </div>
                 <div class="mt-4 border-t pt-4">
                    <h3 class="text-lg font-semibold mb-3">Ferramentas de Limpeza</h3>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="formatText('uppercase')" class="text-sm bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg hover:bg-gray-300 transition">MAI√öSCULAS</button>
                        <button onclick="formatText('lowercase')" class="text-sm bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg hover:bg-gray-300 transition">min√∫sculas</button>
                        <button onclick="formatText('sentencecase')" class="text-sm bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg hover:bg-gray-300 transition">Frase</button>
                        <button onclick="formatText('removeextraspaces')" class="text-sm bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg hover:bg-gray-300 transition">Remover Espa√ßos Extras</button>
                    </div>
                </div>
            </div>

            <!-- Coluna de Resultados -->
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Resultados da An√°lise</h2>
                     <button id="export-btn" class="bg-green-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-600 transition duration-300 shadow-sm text-sm hidden">Exportar Relat√≥rio</button>
                </div>
                
                <div id="results-placeholder" class="text-center py-16">
                    <p class="text-gray-500">Os resultados da sua an√°lise aparecer√£o aqui.</p>
                </div>

                <div id="loader" class="hidden justify-center items-center py-16">
                    <div class="loader"></div>
                    <p class="ml-4 text-gray-600">Analisando...</p>
                </div>

                <div id="results-dashboard" class="hidden">
                    <!-- Abas de Navega√ß√£o -->
                    <div class="border-b border-gray-200 mb-4">
                        <nav class="flex flex-wrap -mb-px" aria-label="Tabs">
                            <button class="tab-button active" data-tab="overview">Vis√£o Geral</button>
                            <button class="tab-button" data-tab="enem">An√°lise ENEM</button>
                            <button class="tab-button" data-tab="readability">Legibilidade</button>
                            <button class="tab-button" data-tab="keywords">Palavras-chave</button>
                            <button class="tab-button" data-tab="sentiment">Sentimento</button>
                            <button class="tab-button" data-tab="grammar">Gram√°tica</button>
                            <button class="tab-button" data-tab="compare">Comparar</button>
                        </nav>
                    </div>

                    <!-- Conte√∫do das Abas -->
                    <div id="tab-content">
                        <!-- Vis√£o Geral -->
                        <div id="overview" class="tab-pane active">
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <div class="bg-blue-50 p-4 rounded-lg text-center"><div class="text-3xl font-bold text-blue-600" id="word-count">0</div><div class="text-sm text-blue-800">Palavras</div></div>
                                <div class="bg-indigo-50 p-4 rounded-lg text-center"><div class="text-3xl font-bold text-indigo-600" id="char-count">0</div><div class="text-sm text-indigo-800">Caracteres</div></div>
                                <div class="bg-purple-50 p-4 rounded-lg text-center"><div class="text-3xl font-bold text-purple-600" id="sentence-count">0</div><div class="text-sm text-purple-800">Senten√ßas</div></div>
                                <div class="bg-pink-50 p-4 rounded-lg text-center"><div class="text-3xl font-bold text-pink-600" id="paragraph-count">0</div><div class="text-sm text-pink-800">Par√°grafos</div></div>
                                <div class="bg-green-50 p-4 rounded-lg text-center col-span-2 md:col-span-1"><div class="text-3xl font-bold text-green-600" id="reading-time">0</div><div class="text-sm text-green-800">Tempo de Leitura</div></div>
                            </div>
                        </div>
                        <!-- An√°lise ENEM -->
                        <div id="enem" class="tab-pane hidden space-y-3 max-h-[500px] overflow-y-auto pr-2">
                           <!-- O conte√∫do ser√° gerado dinamicamente -->
                        </div>
                        <!-- Legibilidade -->
                        <div id="readability" class="tab-pane hidden space-y-4">
                             <div class="bg-gray-100 p-4 rounded-lg">
                                <h4 class="font-semibold text-gray-800">√çndice Flesch-Kincaid (Portugu√™s)</h4>
                                <p class="text-sm text-gray-600">Mede a facilidade de leitura. Pontua√ß√µes mais altas indicam texto mais f√°cil de ler (escala 0-100).</p>
                                <div class="text-2xl font-bold text-gray-900 mt-2" id="flesch-kincaid-score">N/A</div>
                            </div>
                        </div>
                        <!-- Palavras-chave -->
                        <div id="keywords" class="tab-pane hidden">
                            <h4 class="font-semibold mb-2">Densidade de Palavras-chave</h4>
                            <div class="h-64"><canvas id="keyword-chart"></canvas></div>
                            <div id="keyword-table" class="mt-4 max-h-48 overflow-y-auto"></div>
                        </div>
                        <!-- Sentimento -->
                        <div id="sentiment" class="tab-pane hidden text-center">
                            <h4 class="font-semibold mb-4">An√°lise de Sentimento (Beta)</h4>
                            <div id="sentiment-result" class="text-5xl font-bold">üòê</div>
                            <div id="sentiment-score" class="text-lg font-semibold mt-2">Neutro</div>
                            <p class="text-sm text-gray-500 mt-2">Esta √© uma an√°lise simplificada baseada em um l√©xico de palavras.</p>
                        </div>
                        <!-- Gram√°tica -->
                        <div id="grammar" class="tab-pane hidden">
                             <h4 class="font-semibold mb-2">Verifica√ß√£o de Gram√°tica e Ortografia (Beta)</h4>
                             <div id="grammar-suggestions" class="space-y-2 max-h-64 overflow-y-auto">
                                <p class="text-gray-500">Nenhuma sugest√£o encontrada.</p>
                             </div>
                        </div>
                        <!-- Comparar -->
                        <div id="compare" class="tab-pane hidden">
                            <h4 class="font-semibold mb-2">Comparar com Outro Texto</h4>
                            <textarea id="text-compare-input" class="w-full h-48 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Cole o segundo texto aqui para comparar..."></textarea>
                            <button id="compare-btn" class="mt-2 w-full bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">Comparar</button>
                            <div id="similarity-result" class="mt-4 text-center hidden">
                                <p class="text-lg">N√≠vel de Similaridade:</p>
                                <div class="text-4xl font-bold text-indigo-600">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const textInput = document.getElementById('text-input');
        const analyzeBtn = document.getElementById('analyze-btn');
        const clearBtn = document.getElementById('clear-btn');
        const exportBtn = document.getElementById('export-btn');
        const resultsPlaceholder = document.getElementById('results-placeholder');
        const loader = document.getElementById('loader');
        const resultsDashboard = document.getElementById('results-dashboard');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');
        const compareBtn = document.getElementById('compare-btn');

        let keywordChartInstance = null;
        
        // Dicion√°rios e listas para an√°lises
        const stopWords = new Set(['de', 'a', 'o', 'que', 'e', 'do', 'da', 'em', 'um', 'para', '√©', 'com', 'n√£o', 'uma', 'os', 'no', 'se', 'na', 'por', 'mais', 'as', 'dos', 'como', 'mas', 'foi', 'ao', 'ele', 'das', 'tem', '√†', 'seu', 'sua', 'ou', 'ser', 'quando', 'muito', 'h√°', 'nos', 'j√°', 'est√°', 'eu', 'tamb√©m', 's√≥', 'pelo', 'pela', 'at√©', 'isso', 'ela', 'entre', 'depois', 'sem', 'mesmo', 'aos', 'ter', 'seus', 'quem', 'nas', 'me', 'esse', 'eles', 'est√£o', 'voc√™', 'tinha', 'foram', 'essa', 'num', 'nem', 'suas', 'meu', '√†s', 'minha', 't√™m', 'numa', 'pelos', 'elas', 'havia', 'seja', 'qual', 'ser√°', 'n√≥s', 'tenho', 'lhe', 'deles', 'essas', 'esses', 'pelas', 'este', 'fosse', 'dele', 'tu', 'te', 'voc√™s', 'vos', 'lhes', 'meus', 'minhas', 'teu', 'tua', 'teus', 'tuas', 'nosso', 'nossa', 'nossos', 'nossas', 'dela', 'delas', 'esta', 'estes', 'estas', 'aquele', 'aquela', 'aqueles', 'aquelas', 'isto', 'aquilo', 'estou', 'est√°', 'estamos', 'est√£o', 'estive', 'esteve', 'estivemos', 'estiveram', 'estava', 'est√°vamos', 'estavam', 'estivera', 'estiv√©ramos', 'esteja', 'estejamos', 'estejam', 'estivesse', 'estiv√©ssemos', 'estivessem', 'estiver', 'estivermos', 'estiverem', 'hei', 'h√°', 'havemos', 'h√£o', 'houve', 'houvemos', 'houveram', 'houvera', 'houv√©ramos', 'haja', 'hajamos', 'hajam', 'houvesse', 'houv√©ssemos', 'houvessem', 'houver', 'houvermos', 'houverem', 'houverei', 'houver√°', 'houveremos', 'houver√£o', 'houveria', 'houver√≠amos', 'houveriam', 'sou', 'somos', 's√£o', 'era', '√©ramos', 'eram', 'fui', 'foi', 'fomos', 'foram', 'fora', 'f√¥ramos', 'seja', 'sejamos', 'sejam', 'fosse', 'f√¥ssemos', 'fossem', 'for', 'formos', 'forem', 'serei', 'ser√°', 'seremos', 'ser√£o', 'seria', 'ser√≠amos', 'seriam', 'tenho', 'tem', 'temos', 't√©m', 'tinha', 't√≠nhamos', 'tinham', 'tive', 'teve', 'tivemos', 'tiveram', 'tivera', 'tiv√©ramos', 'tenha', 'tenhamos', 'tenham', 'tivesse', 'tiv√©ssemos', 'tivessem', 'tiver', 'tivermos', 'tiverem', 'terei', 'ter√°', 'teremos', 'ter√£o', 'teria', 'ter√≠amos', 'teriam']);
        const positiveWords = new Set(['bom', '√≥timo', 'excelente', 'maravilhoso', 'feliz', 'alegre', 'sucesso', 'amor', 'paz', 'incr√≠vel', 'fant√°stico', 'positivo', 'bem', 'lindo', 'bonito', 'adoro']);
        const negativeWords = new Set(['ruim', 'p√©ssimo', 'terr√≠vel', 'horr√≠vel', 'triste', 'raiva', '√≥dio', 'medo', 'negativo', 'mal', 'feio', 'odeio', 'problema', 'dif√≠cil']);
        const spellingDict = {
            'derrepente': 'de repente', 'concerteza': 'com certeza', 'denovo': 'de novo', 'agente': 'a gente', 'mecher': 'mexer',
            'imprecionante': 'impressionante', 'geito': 'jeito', 'menas': 'menos', 'paraliza√ß√£o': 'paralisa√ß√£o', 'atravez': 'atrav√©s',
            'ascen√ß√£o': 'ascens√£o', 'previl√©gio': 'privil√©gio', 'derrepente': 'de repente', ' derepente': ' de repente'
        };
        const argumentativeConnectors = ['portanto', 'logo', 'assim', 'desse modo', 'dessa forma', 'consequentemente', 'entretanto', 'por√©m', 'mas', 'contudo', 'todavia', 'no entanto', 'al√©m disso', 'ademais', 'outrossim', 'igualmente', 'por exemplo', 'isto √©', 'ou seja'];
        const interventionAgents = ['governo', 'minist√©rio', 'm√≠dia', 'imprensa', 'escola', 'institui√ß√µes de ensino', 'sociedade', 'cidad√£os', 'ongs', 'fam√≠lia'];
        const interventionActions = ['criar', 'implementar', 'fiscalizar', 'promover', 'conscientizar', 'investir', 'desenvolver', 'garantir', 'punir', 'elaborar'];
        const interventionMeans = ['por meio de', 'atrav√©s de', 'mediante', 'com o uso de', 'pela cria√ß√£o de'];
        const interventionPurposes = ['a fim de', 'para que', 'com o objetivo de', 'com o intuito de', 'para'];

        // Fun√ß√µes de an√°lise
        const getWords = (text) => text.trim().match(/[a-zA-Z√Ä-√∫]+/g) || [];
        const getSentences = (text) => text.trim().split(/[.!?]+/).filter(s => s.trim().length > 0);
        const getParagraphs = (text) => text.trim().split(/\n+/).filter(p => p.trim().length > 0);
        const countSyllables = (word) => {
            word = word.toLowerCase();
            if (word.length <= 3) return 1;
            word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '');
            word = word.replace(/^y/, '');
            const matches = word.match(/[aeiouy]{1,2}/g);
            return matches ? matches.length : 0;
        };

        // Event Listeners
        analyzeBtn.addEventListener('click', () => {
            const text = textInput.value;
            if (text.trim().length === 0) {
                // Em vez de alert, usamos um modal ou uma mensagem inline no futuro. Por enquanto, alert √© o mais simples.
                alert('Por favor, insira um texto para analisar.');
                return;
            }
            resultsPlaceholder.classList.add('hidden');
            resultsDashboard.classList.add('hidden');
            loader.style.display = 'flex';
            setTimeout(() => {
                runAnalysis(text);
                loader.style.display = 'none';
                resultsDashboard.classList.remove('hidden');
                exportBtn.classList.remove('hidden');
            }, 500);
        });

        clearBtn.addEventListener('click', () => {
            textInput.value = '';
            resultsDashboard.classList.add('hidden');
            resultsPlaceholder.classList.remove('hidden');
            exportBtn.classList.add('hidden');
            document.getElementById('text-compare-input').value = '';
            if(document.getElementById('similarity-result')) document.getElementById('similarity-result').classList.add('hidden');
        });

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                tabPanes.forEach(pane => pane.classList.add('hidden'));
                document.getElementById(button.dataset.tab).classList.remove('hidden');
            });
        });
        
        compareBtn.addEventListener('click', () => {
            const text1 = textInput.value;
            const text2 = document.getElementById('text-compare-input').value;
            if (!text1.trim() || !text2.trim()) {
                alert('Por favor, preencha ambos os campos de texto para comparar.');
                return;
            }
            const words1 = new Set(getWords(text1.toLowerCase()));
            const words2 = new Set(getWords(text2.toLowerCase()));
            const intersection = new Set([...words1].filter(word => words2.has(word)));
            const union = new Set([...words1, ...words2]);
            const similarity = union.size === 0 ? 0 : (intersection.size / union.size) * 100;
            const resultDiv = document.getElementById('similarity-result');
            resultDiv.querySelector('.text-4xl').textContent = `${similarity.toFixed(1)}%`;
            resultDiv.classList.remove('hidden');
        });

        exportBtn.addEventListener('click', generateReport);

        function runAnalysis(text) {
            // An√°lises Gerais
            const words = getWords(text);
            const sentences = getSentences(text);
            const paragraphs = getParagraphs(text);
            const wordCount = words.length;
            
            // 1. Vis√£o Geral
            document.getElementById('word-count').textContent = wordCount;
            document.getElementById('char-count').textContent = text.length;
            document.getElementById('sentence-count').textContent = sentences.length;
            document.getElementById('paragraph-count').textContent = paragraphs.length;
            document.getElementById('reading-time').textContent = `${Math.ceil(wordCount / 200)} min`;

            // 2. Legibilidade
            if (wordCount > 0 && sentences.length > 0) {
                const totalSyllables = words.reduce((acc, word) => acc + countSyllables(word), 0);
                const fleschScore = 248.835 - (1.015 * (wordCount / sentences.length)) - (84.6 * (totalSyllables / wordCount));
                document.getElementById('flesch-kincaid-score').textContent = `${fleschScore.toFixed(2)} (${getFleschMeaning(fleschScore)})`;
            } else {
                 document.getElementById('flesch-kincaid-score').textContent = 'N/A';
            }

            // 3. Palavras-chave
            const wordFrequencies = {};
            words.forEach(word => {
                const lowerWord = word.toLowerCase();
                if (!stopWords.has(lowerWord) && lowerWord.length > 2) {
                    wordFrequencies[lowerWord] = (wordFrequencies[lowerWord] || 0) + 1;
                }
            });
            const sortedKeywords = Object.entries(wordFrequencies).sort((a, b) => b[1] - a[1]).slice(0, 10);
            updateKeywordChart(sortedKeywords);
            updateKeywordTable(sortedKeywords, wordCount);

            // 4. Sentimento
            let score = 0;
            words.forEach(word => {
                const lowerWord = word.toLowerCase();
                if (positiveWords.has(lowerWord)) score++;
                if (negativeWords.has(lowerWord)) score--;
            });
            let sentiment, emoji;
            if (score > 2) { sentiment = 'Positivo'; emoji = 'üòä'; }
            else if (score > 0) { sentiment = 'Levemente Positivo'; emoji = 'üôÇ'; }
            else if (score < -2) { sentiment = 'Negativo'; emoji = 'üòû'; }
            else if (score < 0) { sentiment = 'Levemente Negativo'; emoji = 'üòï'; }
            else { sentiment = 'Neutro'; emoji = 'üòê'; }
            document.getElementById('sentiment-result').textContent = emoji;
            document.getElementById('sentiment-score').textContent = sentiment;
            
            // 5. Gram√°tica (geral)
            const grammarSuggestionsDiv = document.getElementById('grammar-suggestions');
            const suggestions = checkGrammar(text);
            if (suggestions.length > 0) {
                grammarSuggestionsDiv.innerHTML = suggestions.map(s => `
                    <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <p class="text-sm">Poss√≠vel erro: <strong class="text-red-600">${s.error}</strong></p>
                        <p class="text-sm">Sugest√£o: <strong class="text-green-600">${s.suggestion}</strong></p>
                    </div>
                `).join('');
            } else {
                grammarSuggestionsDiv.innerHTML = '<p class="text-gray-500">Nenhuma sugest√£o encontrada.</p>';
            }

            // 6. An√°lise ENEM
            runEnemAnalysis(text, { words, sentences, paragraphs, wordFrequencies });
        }

        // ... (demais fun√ß√µes como getFleschMeaning, updateKeywordChart, etc. permanecem aqui)
        function getFleschMeaning(score) {
            if (score >= 90) return "Muito f√°cil";
            if (score >= 70) return "F√°cil";
            if (score >= 50) return "M√©dio";
            if (score >= 30) return "Dif√≠cil";
            return "Muito dif√≠cil";
        }

        function updateKeywordChart(keywords) {
            const ctx = document.getElementById('keyword-chart').getContext('2d');
            const labels = keywords.map(kw => kw[0]);
            const data = keywords.map(kw => kw[1]);

            if (keywordChartInstance) {
                keywordChartInstance.destroy();
            }

            keywordChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequ√™ncia',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }

        function updateKeywordTable(keywords, totalWords) {
            const tableDiv = document.getElementById('keyword-table');
            if (keywords.length === 0) {
                tableDiv.innerHTML = '<p class="text-gray-500">Nenhuma palavra-chave significativa encontrada.</p>';
                return;
            }
            let tableHtml = `<table class="w-full text-sm text-left text-gray-500"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th scope="col" class="px-6 py-3">Palavra-chave</th><th scope="col" class="px-6 py-3">Ocorr√™ncias</th><th scope="col" class="px-6 py-3">Densidade</th></tr></thead><tbody>`;
            keywords.forEach(([word, count]) => {
                const density = totalWords > 0 ? ((count / totalWords) * 100).toFixed(2) : 0;
                tableHtml += `<tr class="bg-white border-b"><th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${word}</th><td class="px-6 py-4">${count}</td><td class="px-6 py-4">${density}%</td></tr>`;
            });
            tableHtml += '</tbody></table>';
            tableDiv.innerHTML = tableHtml;
        }
        
        function checkGrammar(text) {
            let suggestions = [];
            const textWords = text.toLowerCase().match(/\b(\w+)\b/g) || [];
            textWords.forEach(word => {
                if (spellingDict[word]) {
                    suggestions.push({ error: word, suggestion: spellingDict[word] });
                }
            });
            // Adicionar mais regras aqui se necess√°rio
            return suggestions;
        }

        // NOVA FUN√á√ÉO: An√°lise ENEM
        function runEnemAnalysis(text, metrics) {
            const { paragraphs, wordFrequencies } = metrics;
            const lowerText = text.toLowerCase();
            let totalScore = 0;

            // C1: Norma Culta
            const c1Errors = checkGrammar(text);
            let c1Score = 200;
            if (c1Errors.length > 0) c1Score = Math.max(0, 200 - c1Errors.length * 40);
            const c1Feedback = c1Errors.length > 0 ? c1Errors.map(e => `Verifique o uso de "${e.error}", talvez quisesse dizer "${e.suggestion}".`) : ["Bom dom√≠nio da norma culta."];
            totalScore += c1Score;

            // C2: Tema, Tese e Repert√≥rio
            let c2Score = 40; // Pontua√ß√£o base
            let c2Feedback = [];
            if (paragraphs.length >= 3) {
                 c2Score += 80;
                 c2Feedback.push("Estrutura dissertativa-argumentativa identificada (introdu√ß√£o, desenvolvimento, conclus√£o).");
            } else {
                c2Feedback.push("Aten√ß√£o: A estrutura do texto n√£o parece seguir o modelo dissertativo-argumentativo padr√£o de 3 ou mais par√°grafos.");
            }
            // Simula√ß√£o de repert√≥rio
            if (lowerText.includes('segundo') || lowerText.includes('fil√≥sofo') || lowerText.includes('soci√≥logo') || lowerText.includes('dados de')) {
                c2Score += 80;
                c2Feedback.push("Presen√ßa de ind√≠cios de repert√≥rio sociocultural.");
            } else {
                c2Feedback.push("Dica: Enrique√ßa seu texto com repert√≥rio sociocultural (cita√ß√µes, dados, fatos hist√≥ricos).");
            }
            c2Score = Math.min(200, c2Score);
            totalScore += c2Score;


            // C3: Argumenta√ß√£o
            let c3Score = 0;
            let c3Feedback = [];
            const connectorsFound = argumentativeConnectors.filter(c => lowerText.includes(c));
            if (connectorsFound.length > 5) {
                c3Score = 200;
                c3Feedback.push("Bom uso de conectivos para articular as ideias e argumentos.");
            } else if (connectorsFound.length > 2) {
                c3Score = 120;
                c3Feedback.push("Uso razo√°vel de conectivos, mas a argumenta√ß√£o pode ser mais bem articulada.");
            } else {
                c3Score = 40;
                c3Feedback.push("Aten√ß√£o: Poucos conectivos argumentativos foram encontrados. Busque articular melhor suas ideias.");
            }
            totalScore += c3Score;

            // C4: Coes√£o
            let c4Score = 200;
            let c4Feedback = [];
            const sortedWords = Object.entries(wordFrequencies).sort((a,b) => b[1] - a[1]);
            if (sortedWords.length > 0 && sortedWords[0][1] > 5) { // Se a palavra mais comum aparece mais de 5 vezes
                c4Score -= 80;
                c4Feedback.push(`Aten√ß√£o √† repeti√ß√£o excessiva da palavra "${sortedWords[0][0]}". Use sin√¥nimos.`);
            }
            if (connectorsFound.length < 3) {
                c4Score -= 80;
                c4Feedback.push("Poucos elementos coesivos. Utilize mais pronomes, adv√©rbios e conjun√ß√µes para ligar as partes do texto.");
            }
            if(c4Feedback.length === 0) c4Feedback.push("Boa utiliza√ß√£o dos mecanismos de coes√£o textual.");
            c4Score = Math.max(40, c4Score);
            totalScore += c4Score;

            // C5: Proposta de Interven√ß√£o
            const lastParagraph = paragraphs.length > 0 ? paragraphs[paragraphs.length - 1].toLowerCase() : "";
            let c5Score = 0;
            let c5Feedback = [];
            let elementsFound = new Set();
            if (interventionAgents.some(a => lastParagraph.includes(a))) { c5Score += 40; elementsFound.add("Agente"); }
            if (interventionActions.some(a => lastParagraph.includes(a))) { c5Score += 40; elementsFound.add("A√ß√£o"); }
            if (interventionMeans.some(m => lastParagraph.includes(m))) { c5Score += 40; elementsFound.add("Meio/Modo"); }
            if (interventionPurposes.some(p => lastParagraph.includes(p))) { c5Score += 40; elementsFound.add("Finalidade"); }
            if (lastParagraph.split(' ').length > 40 && elementsFound.size >= 3) { c5Score += 40; elementsFound.add("Detalhamento"); } // Heur√≠stica simples para detalhamento
            c5Score = Math.min(200, c5Score);
            c5Feedback.push(`Elementos da proposta encontrados: ${elementsFound.size > 0 ? [...elementsFound].join(', ') : 'Nenhum'}.`);
            if (elementsFound.size < 5) c5Feedback.push("Lembre-se que uma proposta completa deve conter Agente, A√ß√£o, Meio/Modo, Finalidade e Detalhamento.");
            totalScore += c5Score;

            // Renderiza os resultados
            const enemResults = [
                { title: "C1: Dom√≠nio da norma culta", score: c1Score, feedback: c1Feedback },
                { title: "C2: Compreens√£o do tema e estrutura", score: c2Score, feedback: c2Feedback },
                { title: "C3: Sele√ß√£o e organiza√ß√£o de argumentos", score: c3Score, feedback: c3Feedback },
                { title: "C4: Coes√£o e coer√™ncia", score: c4Score, feedback: c4Feedback },
                { title: "C5: Proposta de interven√ß√£o", score: c5Score, feedback: c5Feedback }
            ];
            displayEnemResults(enemResults, totalScore);
        }

        function displayEnemResults(results, totalScore) {
            const container = document.getElementById('enem');
            container.innerHTML = ''; // Limpa resultados anteriores
            
            const totalScoreHTML = `
                <div class="text-center mb-4 p-4 bg-blue-50 rounded-lg">
                    <h3 class="text-xl font-bold text-blue-800">Nota Total Estimada</h3>
                    <p class="text-5xl font-bold text-blue-600">${totalScore}</p>
                    <p class="text-sm text-gray-500 mt-1">Lembre-se que esta √© uma avalia√ß√£o autom√°tica e simplificada.</p>
                </div>
            `;
            container.innerHTML += totalScoreHTML;

            results.forEach(comp => {
                let scoreColor = 'text-green-600';
                if (comp.score < 120) scoreColor = 'text-yellow-600';
                if (comp.score < 80) scoreColor = 'text-red-600';

                const compHTML = `
                    <div class="p-4 border border-gray-200 rounded-lg">
                        <div class="flex justify-between items-center">
                            <h4 class="font-semibold text-gray-800">${comp.title}</h4>
                            <span class="text-2xl font-bold ${scoreColor}">${comp.score}</span>
                        </div>
                        <ul class="mt-2 text-sm text-gray-600 list-disc list-inside space-y-1">
                            ${comp.feedback.map(f => `<li>${f}</li>`).join('')}
                        </ul>
                    </div>
                `;
                container.innerHTML += compHTML;
            });
        }

        function generateReport() {
            const text = textInput.value;
            let report = `Relat√≥rio de An√°lise Textual\n=================================\n\nTexto Original:\n----------------\n${text}\n\n`;
            
            // Vis√£o Geral
            report += `Vis√£o Geral:\n----------------\n`;
            report += `- Palavras: ${document.getElementById('word-count').textContent}\n- Caracteres: ${document.getElementById('char-count').textContent}\n- Senten√ßas: ${document.getElementById('sentence-count').textContent}\n- Par√°grafos: ${document.getElementById('paragraph-count').textContent}\n- Tempo de Leitura: ${document.getElementById('reading-time').textContent}\n\n`;
            
            // An√°lise ENEM
            report += `An√°lise ENEM:\n----------------\n`;
            const enemResultsContainer = document.getElementById('enem');
            const totalScore = enemResultsContainer.querySelector('.text-5xl')?.textContent || 'N/A';
            report += `Nota Total Estimada: ${totalScore}\n`;
            enemResultsContainer.querySelectorAll('.border').forEach(compDiv => {
                const title = compDiv.querySelector('h4').textContent;
                const score = compDiv.querySelector('span').textContent;
                const feedbackItems = Array.from(compDiv.querySelectorAll('li')).map(li => `- ${li.textContent}`).join('\n');
                report += `\n${title}: ${score}\n${feedbackItems}\n`;
            });

            // ... (outras se√ß√µes do relat√≥rio podem ser adicionadas aqui)

            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'relatorio_analise_textual.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Fun√ß√µes de formata√ß√£o
        function formatText(type) {
            const textInput = document.getElementById('text-input');
            let text = textInput.value;
            switch(type) {
                case 'uppercase': text = text.toUpperCase(); break;
                case 'lowercase': text = text.toLowerCase(); break;
                case 'sentencecase': text = text.toLowerCase().replace(/(^\s*\w|[.!?]\s*\w)/g, c => c.toUpperCase()); break;
                case 'removeextraspaces': text = text.replace(/\s+/g, ' ').trim(); break;
            }
            textInput.value = text;
        }
    });
    </script>
</body>
</html>
